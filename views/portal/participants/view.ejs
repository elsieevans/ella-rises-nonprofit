<%- include('../../partials/portal-header', { currentPage: 'participants', pageTitle: participant.ParticipantFirstName + ' ' + participant.ParticipantLastName }) %>

<div class="page-actions">
  <a href="/portal/participants" class="btn btn-outline">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    Back to Participants
  </a>
  <% if (user && user.role === 'Admin') { %>
    <a href="/portal/participants/<%= participant.ParticipantID %>/edit" class="btn btn-primary">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Edit
    </a>
  <% } %>
</div>

<div class="detail-grid">
  <!-- Main Info Card -->
  <div class="detail-card">
    <div class="detail-header">
      <div class="detail-avatar">
        <%= participant.ParticipantFirstName.charAt(0) %><%= participant.ParticipantLastName.charAt(0) %>
      </div>
      <div class="detail-title">
        <h2><%= participant.ParticipantFirstName %> <%= participant.ParticipantLastName %></h2>
        <span class="status-badge status-active">
          <%= participant.ParticipantRole || 'Participant' %>
        </span>
      </div>
    </div>
    
    <div class="detail-section">
      <h3>Contact Information</h3>
      <dl class="detail-list">
        <dt>Email</dt>
        <dd><a href="mailto:<%= participant.ParticipantEmail %>"><%= participant.ParticipantEmail %></a></dd>
        <dt>Phone</dt>
        <dd><%= participant.ParticipantPhone || '-' %></dd>
        <dt>Date of Birth</dt>
        <dd><%= participant.ParticipantDOB ? new Date(participant.ParticipantDOB).toLocaleDateString() : '-' %></dd>
      </dl>
    </div>

    <div class="detail-section">
      <h3>Address</h3>
      <dl class="detail-list">
        <dt>City</dt>
        <dd><%= participant.ParticipantCity || '-' %></dd>
        <dt>State</dt>
        <dd><%= participant.ParticipantState || '-' %></dd>
        <dt>Zip</dt>
        <dd><%= participant.ParticipantZip || '-' %></dd>
      </dl>
    </div>
    
    <div class="detail-section">
      <h3>School & Career</h3>
      <dl class="detail-list">
        <dt>School</dt>
        <dd><%= participant.SchoolName || '-' %></dd>
        <dt>Employer</dt>
        <dd><%= participant.EmployerName || '-' %></dd>
        <dt>Field of Interest</dt>
        <dd><%= participant.ParticipantFieldOfInterest || '-' %></dd>
      </dl>
    </div>
  </div>
  
  <!-- Milestones Card -->
  <div class="detail-card">
    <div class="card-header">
      <h3>Milestones Achieved (<%= milestones.length %>)</h3>
    </div>
    
    <% if (milestones && milestones.length > 0) { %>
      <ul class="milestone-list">
        <% milestones.forEach(m => { %>
          <li class="milestone-item">
            <div class="milestone-badge milestone-badge--academic">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
            </div>
            <div class="milestone-info">
              <span class="milestone-name"><%= m.MilestoneTitle %></span>
              <span class="milestone-date">Date: <%= new Date(m.MilestoneDate).toLocaleDateString() %></span>
            </div>
            <% if (user && user.role === 'Admin') { %>
              <form action="/portal/participants/<%= participant.ParticipantID %>/milestones/<%= m.MilestoneID %>/delete" method="POST" class="milestone-delete">
                <button type="submit" class="btn-icon btn-icon--small" title="Remove" onclick="return confirm('Remove this milestone?')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
              </form>
            <% } %>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      <p class="no-data">No milestones achieved yet</p>
    <% } %>
    
    <% if (user && user.role === 'Admin') { %>
      <div class="card-footer">
        <h4>Add Milestone Record</h4>
        <form action="/portal/participants/<%= participant.ParticipantID %>/milestones" method="POST" class="inline-form">
          <div class="form-row">
            <input type="text" name="title" placeholder="Milestone Title" required>
            <input type="date" name="date" value="<%= new Date().toISOString().split('T')[0] %>" required>
          </div>
          <button type="submit" class="btn btn-secondary btn-sm">Add Record</button>
        </form>
      </div>
    <% } %>
  </div>
  
  <!-- Events Card -->
  <div class="detail-card">
    <div class="card-header">
      <h3>Event History (<%= events.length %>)</h3>
    </div>
    
    <% if (events && events.length > 0) { %>
      <ul class="event-list">
        <% events.forEach(e => { %>
          <li class="event-item">
            <div class="event-date-mini">
              <span class="month"><%= new Date(e.EventDateTimeStart).toLocaleString('en-US', { month: 'short' }) %></span>
              <span class="day"><%= new Date(e.EventDateTimeStart).getDate() %></span>
            </div>
            <div class="event-info">
              <span class="event-title"><%= e.EventName %></span>
              <span class="event-meta"><%= new Date(e.EventDateTimeStart).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %></span>
            </div>
            <span class="status-badge status-<%= e.RegistrationStatus %>"><%= e.RegistrationStatus %></span>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      <p class="no-data">No event history</p>
    <% } %>
  </div>
</div>

<%- include('../../partials/portal-footer') %>
