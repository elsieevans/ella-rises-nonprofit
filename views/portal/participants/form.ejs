<%- include('../../partials/portal-header', { currentPage: 'participants', pageTitle: isEdit ? 'Edit Participant' : 'Add Participant' }) %>

<div class="page-actions">
  <a href="/portal/participants" class="btn btn-outline">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    Back to Participants
  </a>
</div>

<div class="form-card">
  <form action="/portal/participants<%= isEdit ? '/' + participant.ParticipantID : '' %>" method="POST" class="crud-form">
    <div class="form-section">
      <h3>Personal Information</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="first_name">First Name <span class="required">*</span></label>
          <input type="text" id="first_name" name="first_name" value="<%= participant.ParticipantFirstName || '' %>" required>
        </div>
        <div class="form-group">
          <label for="last_name">Last Name <span class="required">*</span></label>
          <input type="text" id="last_name" name="last_name" value="<%= participant.ParticipantLastName || '' %>" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="email">Email <span class="required">*</span></label>
          <input type="email" id="email" name="email" value="<%= participant.ParticipantEmail || '' %>" required>
        </div>
        <div class="form-group">
          <label for="phone">Phone <span class="required">*</span></label>
          <input type="tel" id="phone" name="phone" value="<%= participant.ParticipantPhone || '' %>" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="date_of_birth">Date of Birth <span class="required">*</span></label>
          <input type="date" id="date_of_birth" name="date_of_birth" value="<%= participant.ParticipantDOB ? new Date(participant.ParticipantDOB).toISOString().split('T')[0] : '' %>" required>
        </div>
        <div class="form-group">
          <label for="role">Role <span class="required">*</span></label>
          <select id="role" name="role" required>
            <option value="participant" <%= (!participant.ParticipantRole || participant.ParticipantRole === 'participant') ? 'selected' : '' %>>Participant</option>
            <option value="admin" <%= participant.ParticipantRole === 'admin' ? 'selected' : '' %>>Admin (Manager)</option>
          </select>
        </div>
      </div>

      <% if (!isEdit) { %>
      <div class="form-row">
        <div class="form-group">
          <label for="password">Password <small>(optional - will be auto-generated if blank)</small></label>
          <input type="password" id="password" name="password" minlength="6" placeholder="Leave blank to auto-generate">
        </div>
      </div>
      <% } %>
    </div>

    <div class="form-section">
      <h3>Address</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="city">City <span class="required">*</span></label>
          <input type="text" id="city" name="city" value="<%= participant.ParticipantCity || '' %>" required>
        </div>
        <div class="form-group">
          <label for="state">State <span class="required">*</span></label>
          <input type="text" id="state" name="state" value="<%= participant.ParticipantState || '' %>" required>
        </div>
        <div class="form-group">
          <label for="zip">Zip Code <span class="required">*</span></label>
          <input type="text" id="zip" name="zip" value="<%= participant.ParticipantZip || '' %>" required>
        </div>
      </div>
    </div>
    
    <div class="form-section">
      <h3>School & Career</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="school_id">School <span class="required">*</span></label>
          <select id="school_id" name="school_id">
            <option value="">-- Select School --</option>
            <% if (schools && schools.length > 0) { %>
              <% schools.forEach(s => { %>
                <option value="<%= s.SchoolID %>" <%= participant.SchoolID == s.SchoolID ? 'selected' : '' %>><%= s.SchoolName %></option>
              <% }) %>
            <% } %>
          </select>
          <small>Or add a new school below (required if not selected above):</small>
          <input type="text" id="new_school" name="new_school" placeholder="New school name...">
        </div>
        <div class="form-group">
          <label for="employer_id">Employer <span class="required">*</span></label>
          <select id="employer_id" name="employer_id">
            <option value="">-- Select Employer --</option>
            <% if (employers && employers.length > 0) { %>
              <% employers.forEach(e => { %>
                <option value="<%= e.EmployerID %>" <%= participant.EmployerID == e.EmployerID ? 'selected' : '' %>><%= e.EmployerName %></option>
              <% }) %>
            <% } %>
          </select>
          <small>Or add a new employer below (required if not selected above):</small>
          <input type="text" id="new_employer" name="new_employer" placeholder="New employer name...">
        </div>
      </div>

      <div class="form-group">
        <label for="field_of_interest">Field of Interest <span class="required">*</span></label>
        <input type="text" id="field_of_interest" name="field_of_interest" value="<%= participant.ParticipantFieldOfInterest || '' %>" required>
      </div>
    </div>
    
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <%= isEdit ? 'Update Participant' : 'Add Participant' %>
      </button>
      <a href="/portal/participants" class="btn btn-outline">Cancel</a>
    </div>
  </form>
</div>

<%- include('../../partials/portal-footer') %>
