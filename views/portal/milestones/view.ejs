<%- include('../../partials/portal-header', { currentPage: 'milestones', pageTitle: milestoneTitle }) %>

<div class="page-actions">
  <a href="/portal/milestones" class="btn btn-outline">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    Back to Milestones
  </a>
</div>

  <div class="detail-card">
    <div class="milestone-detail-header">
    <div class="milestone-badge-large">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
      </div>
      <div>
      <h2><%= milestoneTitle %></h2>
      <p class="text-muted"><%= achievers.length %> participant<%= achievers.length !== 1 ? 's' : '' %> achieved this milestone</p>
    </div>
    </div>
  </div>
  
<div class="table-card">
    <div class="card-header">
    <h3>Participants Who Achieved This Milestone</h3>
    </div>
    
    <% if (achievers && achievers.length > 0) { %>
      <div class="table-responsive">
      <table class="data-table" role="table" aria-label="Achievers list">
          <thead>
            <tr>
            <th scope="col">Participant</th>
            <th scope="col">Date Achieved</th>
            <% if (achievers[0].MilestoneNo !== undefined) { %>
              <th scope="col">Milestone #</th>
            <% } %>
            <th scope="col" class="actions-col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% achievers.forEach(a => { %>
              <tr>
                <td data-label="Participant">
                <a href="/portal/participants/<%= a.ParticipantID %>">
                  <%= a.ParticipantFirstName %> <%= a.ParticipantLastName %>
                </a>
              </td>
              <td data-label="Date Achieved">
                <%= a.MilestoneDate ? new Date(a.MilestoneDate).toLocaleDateString() : 'Not set' %>
              </td>
              <% if (a.MilestoneNo !== undefined) { %>
                <td data-label="Milestone #"><%= a.MilestoneNo || '-' %></td>
              <% } %>
              <td class="actions-col">
                <div class="action-buttons">
                  <a href="/portal/milestones/<%= a.MilestoneID %>" class="btn-icon" title="View Record" aria-label="View milestone record">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                  </a>
                  <% if (user && user.role === 'Admin') { %>
                    <a href="/portal/milestones/<%= a.MilestoneID %>/edit" class="btn-icon" title="Edit" aria-label="Edit milestone">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    </a>
                    <form action="/portal/milestones/<%= a.MilestoneID %>/delete" method="POST" class="inline-form" onsubmit="return confirm('Remove this participant from this milestone?')">
                      <button type="submit" class="btn-icon btn-icon--danger" title="Delete" aria-label="Remove from milestone">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                      </button>
                    </form>
                  <% } %>
                </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p class="no-data">No participants have achieved this milestone yet</p>
    <% } %>
</div>

<%- include('../../partials/portal-footer') %>
