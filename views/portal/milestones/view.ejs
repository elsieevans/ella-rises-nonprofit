<%- include('../../partials/portal-header', { currentPage: 'milestones', pageTitle: milestone.name }) %>

<div class="page-actions">
  <a href="/portal/milestones" class="btn btn-outline">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    Back to Milestones
  </a>
  <% if (user && user.role === 'manager') { %>
    <a href="/portal/milestones/<%= milestone.id %>/edit" class="btn btn-primary">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Edit
    </a>
  <% } %>
</div>

<div class="detail-grid detail-grid--two">
  <!-- Milestone Info Card -->
  <div class="detail-card">
    <div class="milestone-detail-header">
      <div class="milestone-badge-large milestone-badge--<%= milestone.category %>">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
      </div>
      <div>
        <h2><%= milestone.name %></h2>
        <span class="milestone-category-badge"><%= milestone.category %></span>
        <span class="status-badge <%= milestone.is_active ? 'status-active' : 'status-inactive' %>">
          <%= milestone.is_active ? 'Active' : 'Inactive' %>
        </span>
      </div>
    </div>
    
    <div class="detail-section">
      <dl class="detail-list">
        <dt>Description</dt>
        <dd><%= milestone.description || 'No description' %></dd>
        <dt>Points</dt>
        <dd><%= milestone.points %> points</dd>
        <dt>Badge Icon</dt>
        <dd><%= milestone.badge_icon || 'Default' %></dd>
        <dt>Sort Order</dt>
        <dd><%= milestone.sort_order %></dd>
        <dt>Total Achievers</dt>
        <dd><%= achievers.length %> participants</dd>
      </dl>
    </div>
  </div>
  
  <!-- Achievers Card -->
  <div class="detail-card">
    <div class="card-header">
      <h3>Participants Who Achieved This (<%= achievers.length %>)</h3>
    </div>
    
    <% if (achievers && achievers.length > 0) { %>
      <div class="table-responsive">
        <table class="data-table data-table--compact">
          <thead>
            <tr>
              <th>Participant</th>
              <th>Date Achieved</th>
              <th>Verified By</th>
            </tr>
          </thead>
          <tbody>
            <% achievers.forEach(a => { %>
              <tr>
                <td data-label="Participant">
                  <a href="/portal/participants/<%= a.id %>"><%= a.first_name %> <%= a.last_name %></a>
                </td>
                <td data-label="Date Achieved"><%= new Date(a.achieved_date).toLocaleDateString() %></td>
                <td data-label="Verified By"><%= a.verified_by_first ? a.verified_by_first + ' ' + a.verified_by_last : '-' %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p class="no-data">No participants have achieved this milestone yet</p>
    <% } %>
  </div>
</div>

<%- include('../../partials/portal-footer') %>

